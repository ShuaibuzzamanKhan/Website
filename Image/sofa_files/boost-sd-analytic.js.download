(()=>{"use strict";const t="boostSDAnalytics",e="boostSDSessionId",o={VIEW_PRODUCT:"view_product",QUICK_VIEW:"quick_view",ADD_TO_CART:"add_to_cart",BUY_NOW:"buy_now"},n="filter",r="search",i="suggest",l="recommend",s="boostSDRequestIdProductClickedKey",c="boostSDRecommendationActiveKey";var d,a,u,v,g,p,f,b;const y="boost-sd__",m=`.${y}suggestion-queries-item--product`,S=`.${y}product-item, .${y}product-item-list-view-layout`,_=`.${y}recommendation`,A=`.${y}btn-quick-view`,D=(null===(a=boostSDAppConfig)||void 0===a||null===(d=a.analytics)||void 0===d?void 0:d.selectorAddToCart)?null===(v=boostSDAppConfig)||void 0===v||null===(u=v.analytics)||void 0===u?void 0:u.selectorAddToCart:`.${y}btn-add-to-cart, form[action="/cart/add"] *[type="submit"], form[action="/cart/add"] *[name="add"]`,h=(null===(p=boostSDAppConfig)||void 0===p||null===(g=p.analytics)||void 0===g?void 0:g.selectorBuyNow)?null===(b=boostSDAppConfig)||void 0===b||null===(f=b.analytics)||void 0===f?void 0:f.selectorBuyNow:`.${y}btn-buy-now, .shopify-payment-button__button, .shopify-payment-button, #dynamic-checkout-cart`,O=`.${y}quick-view`;function I(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function x(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},n=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter((function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable})))),n.forEach((function(e){I(t,e,o[e])}))}return t}var k,w,C="";const T=localStorage.getItem(e);var R,q=T?null===(k=T)||void 0===k?void 0:k.replaceAll('"',""):"";T&&(null===(w=T)||void 0===w?void 0:w.includes(""))&&localStorage.setItem(e,null===(R=T)||void 0===R?void 0:R.replaceAll('"',""));const N=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})),j=t=>{try{const e=localStorage.getItem(t);return e?JSON.parse(e):null}catch(t){return null}},E=(t,e)=>{try{null!=e?localStorage.setItem(t,JSON.stringify(e)):localStorage.setItem(t,"")}catch(t){}},U=()=>{var t,e;return"collection"===(null===(e=boostSDAppConfig)||void 0===e||null===(t=e.generalSettings)||void 0===t?void 0:t.page)},W=()=>{var t,e;return"search"===(null===(e=boostSDAppConfig)||void 0===e||null===(t=e.generalSettings)||void 0===t?void 0:t.page)},P=()=>{var t,e;return"product"===(null===(e=boostSDAppConfig)||void 0===e||null===(t=e.generalSettings)||void 0===t?void 0:t.page)},K=()=>{let t="";switch(!0){case U():t="collection_page";break;case W():t="search_page";break;case P():t="product_page";break;case(()=>{var t,e;return"cart"===(null===(e=boostSDAppConfig)||void 0===e||null===(t=e.generalSettings)||void 0===t?void 0:t.page)})():t="cart_page";break;case(()=>{var t,e;return"index"===(null===(e=boostSDAppConfig)||void 0===e||null===(t=e.generalSettings)||void 0===t?void 0:t.page)})():t="home_page"}return t},B=t=>{const e=j("boostSDRequestIdSaveInfoRequest");return e&&e[t]?e[t]:{query_string:"",action:"filter"}},$=(t,d,a,u={})=>{var v,g;let p=(null===(v=u)||void 0===v?void 0:v.rid)?null===(g=u)||void 0===g?void 0:g.rid:((t,e)=>{let o="";switch(e){case n:o="boostSDRequestIdFilterKey";break;case r:o="boostSDRequestIdSearchKey";break;case i:o="boostSDRequestIdSuggestKey";break;case l:o="boostSDRequestIdRecommendationKey"}if(!o)return"";if(e===l){const e=j(c);if(e&&e.pid===t)return e.rid}const s=j(o);if(s){const e=Object.keys(s);for(let o=0;o<e.length;o++){var d;if(null===(d=s[e[o]])||void 0===d?void 0:d.includes(Number(t)))return e[o]}}return""})(t,a);if(a){const e=((t,e=50)=>{let o=j(t)||{};if(Object.keys(o).length>=e){const t={},n=Object.keys(o),r=Object.values(o);for(let o=0;o<e;o++)t[n[o]]=r[o];o=t}return o})(s,3),o=x({[Number(t)]:p},e);E(s,o)}if(!a||!p){const e=j(s);if(!e||!e[Number(t)])return!1;p=e[Number(t)]}const f=B(p).query_string;d===o.QUICK_VIEW&&(d=o.VIEW_PRODUCT),a||(a=B(p).action);const b=C;return x({tid:Shopify.shop,qs:f,eid:N(),rid:p,ct:b||localStorage.getItem("cartToken"),pid:t,t:(new Date).toISOString(),u:d,a:a||"other",r:document.referrer,sid:q||(q=N(),localStorage.setItem(e,q),q),cid:(null===(y=__st)||void 0===y?void 0:y.id)||(null===(S=meta)||void 0===S||null===(m=S.page)||void 0===m?void 0:m.customerId)||(null===(D=ShopifyAnalytics)||void 0===D||null===(A=D.meta)||void 0===A||null===(_=A.page)||void 0===_?void 0:_.customerId)||(null===(k=ShopifyAnalytics)||void 0===k||null===(I=k.lib)||void 0===I||null===(O=I.user())||void 0===O||null===(h=O.traits())||void 0===h?void 0:h.uniqToken),pg:K()},u);var y,m,S,_,A,D,h,O,I,k},V=e=>{var o=j(t);Array.isArray(o)||(o=[]);const n=o.filter((t=>t.pid!=e.productId));n.push(e),E(t,n)};const Y=(e,o)=>{var n,r;const i=(null===(r=window.boostSDAppConfig)||void 0===r||null===(n=r.api)||void 0===n?void 0:n.analyticsUrl)||"https://lambda.mybcapps.com/e";if("recommend"===e.a&&["add_to_cart","buy_now"].includes(e.u)&&localStorage.removeItem(c),o)return setTimeout((()=>{return t=e,void fetch("/cart.js").then((t=>t.json())).then((e=>{const o=e.token;C=o,o&&localStorage.setItem("cartToken",o),t&&(t.ct=o,Y(t,!1))})).catch((e=>{Y(t,!1),console.log("error call refresh cartToken, send tracking without cart token",e)}));var t}),1200);(async function(t="",e={}){return(await fetch(t,{method:"POST",body:JSON.stringify(e)})).json()})(i,e).then((o=>{(o.error="")&&(e=>{var o=j(t);if(Array.isArray(o)){var n=o.filter((t=>t.pid!=e));E(t,n)}})(e.pid)}))},L=t=>{if(!t||!t.target)return;if("keydown"==t.type&&"Enter"!==t.key)return;const e=t.target.closest(m);if(!e)return;const n=e.getAttribute("data-id");if(!n)return;const r=$(n,o.VIEW_PRODUCT,i);V(r),Y(r)};(t=>{if(!t)return null;console.log("register event initInstantSearch"),document.addEventListener("click",L,!0),document.addEventListener("keydown",L,!0)})(!0);const J=t=>{if(!t||!t.target)return;const e=t.target;let i=W()?r:U?n:l;if(e.closest(_)&&(i=l),i!==l&&P())return;let s=o.VIEW_PRODUCT;e.closest(A)?s=o.QUICK_VIEW:e.closest(h)?s=o.BUY_NOW:e.closest(D)&&(s=o.ADD_TO_CART);let d="";const a=e.closest(S);var u;a?d=a.getAttribute("id")||"":s!=o.ADD_TO_CART&&s!=o.BUY_NOW||(d=null===(u=e.closest(O))||void 0===u?void 0:u.getAttribute("product-id"));if(!d)return;if(e.closest(O)){const t=j(c);t&&d===t.pid&&(i=l)}const v={};if(i===l){var g,p;const t=null===(g=e.closest(_))||void 0===g?void 0:g.parentNode;if(null===(p=t)||void 0===p?void 0:p.id){var f,b,y;const e=null===(f=t.id)||void 0===f?void 0:f.replace("boost-sd-widget-",""),o=null===(b=t.classList[0])||void 0===b?void 0:b.replace("boost-sd-","");v.wid=e,v.rt=o;const n=j("boostSDRequestIdMoreInformationKey");if((null===(y=Object.keys(n))||void 0===y?void 0:y.length)>0){var m;const t=Object.keys(n).find((t=>n[t].wid===e));!v.rt&&n[t]&&(v.rt=null===(m=n[t])||void 0===m?void 0:m.rt),v.rid=t,E(c,{rid:t,wid:v.wid,rt:v.rt,pid:d})}}}if(P()&&[o.ADD_TO_CART,o.BUY_NOW].includes(s))return;const I=$(d,s,i,v);V(I),Y(I,[o.ADD_TO_CART,o.BUY_NOW].includes(s))};console.log("register event initCollectionSearchPage"),document.addEventListener("click",J,!0);const Q=t=>{if(!t||!t.target)return;const e=t.target,n=e.closest(h);if(e.closest(D)||n){var r,i,l;let t={pid:null===(l=boostSDAppConfig)||void 0===l||null===(i=l.generalSettings)||void 0===i||null===(r=i.product_id)||void 0===r?void 0:r.toString(),u:n?o.BUY_NOW:o.ADD_TO_CART},c="";const d=e.closest(_);if(d){var s;const e=null===(s=d.parentElement)||void 0===s?void 0:s.id;e&&(c="recommend",t.wid=e.replace("boost-sd-widget-",""))}const a=e.closest(O);if(a){const e=a.getAttribute("product-id");e&&(t.pid=e,c="recommend")}if(t=$(t.pid,t.u,c,t),!t)return;V(t),Y(t,!0)}};P()&&(console.log("register event initOtherPage"),document.addEventListener("click",Q,!0))})();